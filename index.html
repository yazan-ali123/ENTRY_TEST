<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تحدي التعقيد الزمني (USACO Bronze)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        
        .code-font {
            font-family: 'JetBrains Mono', monospace;
            direction: ltr; /* Code always LTR */
            text-align: left;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(229, 231, 235, 0.5);
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-4xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-3 space-x-reverse">
                <i class="fa-solid fa-stopwatch text-indigo-600 text-xl"></i>
                <h1 class="font-bold text-lg hidden sm:block">USACO Bronze: التعقيد الزمني</h1>
                <h1 class="font-bold text-lg sm:hidden">التعقيد الزمني</h1>
            </div>
            
            <div id="timer-container" class="hidden flex items-center bg-slate-100 px-4 py-1.5 rounded-full font-mono font-bold text-indigo-700 border border-slate-200" dir="ltr">
                <i class="fa-regular fa-clock mr-2"></i>
                <span id="timer">60:00</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col items-center justify-center p-4">
        
        <!-- Start Screen -->
        <div id="start-screen" class="max-w-2xl w-full glass-panel rounded-2xl shadow-xl p-8 text-center fade-in">
            <div class="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6 text-indigo-600">
                <i class="fa-solid fa-code text-3xl"></i>
            </div>
            <h2 class="text-3xl font-extrabold text-slate-900 mb-4">تحدي التعقيد الزمني</h2>
            <p class="text-slate-600 mb-8 text-lg leading-relaxed">
                اختبار عملي في Big O notation وقيود الوقت في C++.
                <br>
                <strong>المدة الزمنية: 60 دقيقة</strong>
            </p>
            
            <button onclick="startQuiz()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-xl w-full sm:w-auto transition-all transform hover:scale-105 shadow-lg shadow-indigo-200">
                ابدأ الاختبار
            </button>
        </div>

        <!-- Quiz Interface -->
        <div id="quiz-interface" class="hidden w-full max-w-3xl">
            <!-- Progress Bar -->
            <div class="mb-6">
                <div class="flex justify-between text-xs font-semibold text-slate-500 mb-2 uppercase tracking-wide">
                    <span>السؤال <span id="current-q-num">1</span> من 10</span>
                    <span id="progress-percent">0%</span>
                </div>
                <div class="h-2 bg-slate-200 rounded-full overflow-hidden" dir="ltr">
                    <div id="progress-bar" class="h-full bg-indigo-600 transition-all duration-500 ease-out" style="width: 10%"></div>
                </div>
            </div>

            <!-- Question Card -->
            <div class="glass-panel rounded-2xl shadow-xl overflow-hidden fade-in">
                <div class="p-6 sm:p-8">
                    <div class="mb-6">
                        <span class="inline-block bg-indigo-100 text-indigo-800 text-xs px-2.5 py-0.5 rounded-full font-bold mb-3">
                            <i class="fa-solid fa-brain ml-1"></i> تحليل
                        </span>
                        <h3 id="question-text" class="text-xl font-bold text-slate-800 mb-4 leading-relaxed">
                            <!-- Question injected here -->
                        </h3>
                        <div id="code-snippet-container" class="hidden mb-6 bg-slate-900 rounded-lg p-4 overflow-x-auto border border-slate-700 shadow-inner text-left" dir="ltr">
                            <pre id="code-snippet" class="code-font text-sm text-slate-300"></pre>
                        </div>
                    </div>

                    <div id="options-container" class="space-y-3">
                        <!-- Options injected here -->
                    </div>
                </div>
                
                <div class="bg-slate-50 px-6 py-4 border-t border-slate-200 flex justify-between items-center">
                    <button id="prev-btn" onclick="prevQuestion()" class="text-slate-500 hover:text-slate-800 font-semibold px-4 py-2 rounded-lg transition-colors disabled:opacity-30" disabled>
                        <i class="fa-solid fa-arrow-right ml-2"></i>السابق
                    </button>
                    <button id="next-btn" onclick="nextQuestion()" class="bg-slate-800 hover:bg-slate-900 text-white font-semibold px-6 py-2 rounded-lg transition-colors shadow-md">
                        التالي <i class="fa-solid fa-arrow-left mr-2"></i>
                    </button>
                    <button id="submit-btn" onclick="submitQuiz()" class="hidden bg-indigo-600 hover:bg-indigo-700 text-white font-bold px-6 py-2 rounded-lg transition-colors shadow-md shadow-indigo-200">
                        إنهاء وتسليم
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden w-full max-w-4xl fade-in">
            <div class="glass-panel rounded-2xl shadow-xl p-8 mb-8 text-center border-t-8 border-indigo-600">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">اكتمل الاختبار</h2>
                <div class="flex items-center justify-center my-6">
                    <div class="relative">
                        <svg class="w-32 h-32 transform -rotate-90">
                            <circle cx="64" cy="64" r="56" stroke="#e2e8f0" stroke-width="12" fill="none"></circle>
                            <circle id="score-ring" cx="64" cy="64" r="56" stroke="#4f46e5" stroke-width="12" fill="none" stroke-dasharray="351.86" stroke-dashoffset="351.86" class="transition-all duration-1000 ease-out"></circle>
                        </svg>
                        <div class="absolute top-0 left-0 w-full h-full flex flex-col items-center justify-center">
                            <span id="score-display" class="text-4xl font-extrabold text-slate-900">0</span>
                            <span class="text-xs text-slate-500 font-bold uppercase">/ 10</span>
                        </div>
                    </div>
                </div>
                <!-- Removed motivational text -->
                <div class="flex justify-center gap-4">
                    <button onclick="location.reload()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                        إعادة الاختبار
                    </button>
                    <button onclick="document.getElementById('review-section').scrollIntoView({behavior: 'smooth'})" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 font-semibold py-2 px-6 rounded-lg transition-colors">
                        مراجعة الإجابات
                    </button>
                </div>
            </div>

            <div id="review-section" class="space-y-6">
                <h3 class="text-xl font-bold text-slate-800 ml-2">تفاصيل الإجابات</h3>
                <!-- Review cards injected here -->
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 py-6 mt-8">
        <div class="max-w-4xl mx-auto px-4 text-center text-slate-400 text-sm">
            <p>USACO Guide Practice</p>
        </div>
    </footer>

    <script>
        // --- Quiz Data ---
        const questions = [
            {
                id: 1,
                text: "ما هو التعقيد الزمني في أسوأ حالة (Worst-case) للكود التالي؟",
                code: `for (int i = 0; i < n; i++) {
    for (int j = 0; j < i; j++) {
        cout << i << " " << j << endl;
    }
}`,
                options: [
                    "O(N)",
                    "O(N log N)",
                    "O(N²)",
                    "O(N³)"
                ],
                correct: 2, // Index 2 -> O(N²)
                explanation: "الحلقة الخارجية تعمل N مرة. الحلقة الداخلية تعمل 'i' مرة. إجمالي التكرارات هو 0 + 1 + 2 + ... + (N-1)، وهو مجموع أول N أرقام صحيحة. المجموع يساوي N(N-1)/2، والذي يبسط إلى O(N²)."
            },
            {
                id: 2,
                text: "إذا كانت N ≤ 10⁵، أي من التعقيدات الزمنية التالية من المرجح أن يتجاوز حد الوقت البالغ ثانية واحدة (حوالي 10⁸ عملية)؟",
                code: null,
                options: [
                    "O(N)",
                    "O(N log N)",
                    "O(N√N)",
                    "O(N²)"
                ],
                correct: 3, // Index 3 -> O(N²)
                explanation: "إذا كانت N = 10⁵، فإن N² = (10⁵)² = 10¹⁰. هذا الرقم أكبر بكثير من حد الـ 10⁸ عملية في الثانية. بينما O(N√N) يساوي تقريباً 3x10⁷، وهو ضمن الحد المقبول."
            },
            {
                id: 3,
                text: "حدد تعقيد بنية الحلقة التالية حيث يزداد متغير الحلقة الداخلية بالضرب.",
                code: `for (int i = 0; i < n; i++) {
    for (int j = 1; j < n; j *= 2) {
        // constant time operation
    }
}`,
                options: [
                    "O(N)",
                    "O(N²)",
                    "O(N log N)",
                    "O(log N)"
                ],
                correct: 2, // Index 2 -> O(N log N)
                explanation: "الحلقة الخارجية تعمل N مرة. الحلقة الداخلية تبدأ من 1 وتضرب j في 2 حتى تصل إلى N. عدد الخطوات للوصول إلى N بالمضاعفة هو log₂(N). لذلك، التعقيد الكلي هو N * log N = O(N log N)."
            },
            {
                id: 4,
                text: "ما هو تعقيد هذه الدالة التكرارية (Recursive)؟",
                code: `int func(int n) {
    if (n <= 1) return 1;
    return func(n - 1) + func(n - 1);
}`,
                options: [
                    "O(N)",
                    "O(N²)",
                    "O(2ᴺ)",
                    "O(N!)"
                ],
                correct: 2, // Index 2 -> O(2^N)
                explanation: "كل استدعاء ينشئ استدعاءين تكراريين جديدين. هذا يخلق شجرة ثنائية من الاستدعاءات بعمق N. العدد الإجمالي للعقد في شجرة ثنائية كاملة بعمق N هو 2ᴺ - 1. إذن التعقيد هو O(2ᴺ)."
            },
            {
                id: 5,
                text: "ما هو تعقيد الكود التالي الذي يتضمن جذوراً تربيعية؟",
                code: `for (int i = 1; i * i <= n; i++) {
    if (n % i == 0) {
        cout << i << endl;
    }
}`,
                options: [
                    "O(N)",
                    "O(log N)",
                    "O(√N)",
                    "O(N/2)"
                ],
                correct: 2, // Index 2 -> O(√N)
                explanation: "شرط الحلقة هو `i * i <= n`، وهو يكافئ `i <= √n`. الحلقة تعمل من 1 حتى √n، مما يجعل التعقيد O(√N)."
            },
            {
                id: 6,
                text: "حلل تعقيد بنية الحلقة المشابهة لـ 'Harmonic Series':",
                code: `for (int i = 1; i <= n; i++) {
    for (int j = i; j <= n; j += i) {
        // constant time operation
    }
}`,
                options: [
                    "O(N)",
                    "O(N²)",
                    "O(N√N)",
                    "O(N log N)"
                ],
                correct: 3, // Index 3 -> O(N log N)
                explanation: "عندما i=1، الحلقة الداخلية تعمل N مرة. عندما i=2، تعمل N/2 مرة. المجموع هو N/1 + N/2 + ... + N/N. بإخراج N كعامل مشترك، نحصل على متسلسلة توافقية مجموعها تقريباً ln(N). إذن O(N log N)."
            },
            {
                id: 7,
                text: "أي عملية قياسية في C++ STL لها تعقيد زمني في أسوأ حالة O(N) بدلاً من O(1) أو O(log N)؟",
                code: null,
                options: [
                    "vector::push_back",
                    "map::insert",
                    "vector::insert (في البداية)",
                    "stack::pop"
                ],
                correct: 2, // Index 2
                explanation: "الإضافة في بداية الـ vector تتطلب إزاحة جميع العناصر N الموجودة خطوة واحدة لليمين لتوفير مساحة، مما ينتج عنه تعقيد O(N). بينما `push_back` هي O(1) تقريباً (amortized)، و `map::insert` هي O(log N)."
            },
            {
                id: 8,
                text: "ما هو التعقيد الزمني لخوارزمية الترتيب القياسية `std::sort` في C++ (بناءً على C++11 والأحدث)؟",
                code: `vector<int> v = {5, 1, 4, 2, 8};\nsort(v.begin(), v.end());`,
                options: [
                    "O(N)",
                    "O(N log N)",
                    "O(N²)",
                    "O(N!)"
                ],
                correct: 1, // Index 1 -> O(N log N)
                explanation: "تضمن دالة `std::sort` في C++ القياسية تعقيد زمني قدره O(N log N) في أسوأ الحالات (عادة ما يتم تنفيذها باستخدام IntroSort وهو مزيج من QuickSort و HeapSort و InsertionSort)."
            },
            {
                id: 9,
                text: "تأمل الحلقة المتداخلة التالية. لاحظ عدم إعادة تعيين المتغير الداخلي j.",
                code: `// نفترض وجود مصفوفة مرتبة
vector<int> arr(n); 
int j = 0;
for(int i = 0; i < n; i++) {
    while(j < n && arr[j] < arr[i]) {
        j++;
    }
}`,
                options: [
                    "O(N)",
                    "O(N²)",
                    "O(N log N)",
                    "O(N√N)"
                ],
                correct: 0, // Index 0 -> O(N)
                explanation: "على الرغم من وجود حلقة while داخل حلقة for، إلا أن المتغير `j` لا يتم تصفيره (إعادته للصفر) في كل تكرار لـ `i`. المتغير `j` يزداد فقط من 0 إلى N عبر *كامل* تنفيذ الكود. إجمالي العمليات لـ i و j هو 2N كحد أقصى، مما يعني O(N)."
            },
            {
                id: 10,
                text: "إذا كانت الخوارزمية ذات تعقيد O(N!) والوقت المسموح ثانية واحدة، فما هي قيمة N التقريبية القصوى التي يمكن حلها؟",
                code: null,
                options: [
                    "N ≈ 10-11",
                    "N ≈ 20-25",
                    "N ≈ 100",
                    "N ≈ 1000"
                ],
                correct: 0, // Index 0
                explanation: "قيمة 10! تساوي 3,628,800. وقيمة 11! تساوي حوالي 39 مليون. أما 12! فتساوي 479 مليون (تتجاوز 10⁸). لذلك N تكون تقريباً 10 أو 11."
            }
        ];

        // --- State ---
        let currentQuestion = 0;
        let userAnswers = new Array(questions.length).fill(null);
        let timeLeft = 60 * 60; // 60 minutes in seconds
        let timerInterval;

        // --- DOM Elements ---
        const startScreen = document.getElementById('start-screen');
        const quizInterface = document.getElementById('quiz-interface');
        const resultsScreen = document.getElementById('results-screen');
        const questionText = document.getElementById('question-text');
        const codeSnippetContainer = document.getElementById('code-snippet-container');
        const codeSnippet = document.getElementById('code-snippet');
        const optionsContainer = document.getElementById('options-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressPercent = document.getElementById('progress-percent');
        const currentQNum = document.getElementById('current-q-num');
        const timerDisplay = document.getElementById('timer');
        const timerContainer = document.getElementById('timer-container');

        // --- Functions ---

        function startQuiz() {
            startScreen.classList.add('hidden');
            quizInterface.classList.remove('hidden');
            quizInterface.classList.add('flex', 'flex-col', 'items-center'); // Ensure flex behavior
            timerContainer.classList.remove('hidden');
            
            loadQuestion(0);
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

                if (timeLeft <= 60) {
                    timerDisplay.parentElement.classList.remove('bg-slate-100', 'text-indigo-700');
                    timerDisplay.parentElement.classList.add('bg-red-100', 'text-red-700', 'animate-pulse');
                }

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        function loadQuestion(index) {
            currentQuestion = index;
            const q = questions[index];

            // Update Text
            questionText.textContent = `${index + 1}. ${q.text}`;
            currentQNum.textContent = index + 1;

            // Update Code Snippet
            if (q.code) {
                codeSnippetContainer.classList.remove('hidden');
                codeSnippet.textContent = q.code;
            } else {
                codeSnippetContainer.classList.add('hidden');
            }

            // Generate Options
            optionsContainer.innerHTML = '';
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = `w-full text-right p-4 rounded-xl border-2 transition-all ${
                    userAnswers[index] === i 
                    ? 'border-indigo-600 bg-indigo-50 text-indigo-900 font-semibold shadow-sm' 
                    : 'border-slate-200 hover:border-indigo-300 hover:bg-slate-50 text-slate-700'
                }`;
                // Icons logic flipped for RTL visually if needed, but flex handles order
                btn.innerHTML = `<div class="flex items-center"><span class="w-6 h-6 rounded-full border-2 flex items-center justify-center ml-3 text-xs ${userAnswers[index] === i ? 'border-indigo-600 bg-indigo-600 text-white' : 'border-slate-300 text-transparent'}"><i class="fa-solid fa-check"></i></span>${opt}</div>`;
                
                btn.onclick = () => selectAnswer(i);
                optionsContainer.appendChild(btn);
            });

            // Update Navigation
            prevBtn.disabled = index === 0;
            if (index === questions.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }

            // Update Progress
            const progress = ((index + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressPercent.textContent = `${Math.round(progress)}%`;
        }

        function selectAnswer(optionIndex) {
            userAnswers[currentQuestion] = optionIndex;
            loadQuestion(currentQuestion); // Re-render to show selection
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                loadQuestion(currentQuestion + 1);
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                loadQuestion(currentQuestion - 1);
            }
        }

        function submitQuiz() {
            clearInterval(timerInterval);
            quizInterface.classList.add('hidden');
            timerContainer.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            
            calculateResults();
        }

        function calculateResults() {
            let score = 0;
            const reviewSection = document.getElementById('review-section');
            reviewSection.innerHTML = '<h3 class="text-xl font-bold text-slate-800 ml-2">تفاصيل الإجابات</h3>';

            questions.forEach((q, index) => {
                const isCorrect = userAnswers[index] === q.correct;
                if (isCorrect) score++;

                // Create Review Card
                const card = document.createElement('div');
                card.className = `glass-panel rounded-xl p-6 border-r-4 ${isCorrect ? 'border-green-500' : 'border-red-500'}`;
                
                let answerStatus = isCorrect 
                    ? `<span class="text-green-600 font-bold"><i class="fa-solid fa-check-circle ml-2"></i>صحيح</span>` 
                    : `<span class="text-red-600 font-bold"><i class="fa-solid fa-times-circle ml-2"></i>خطأ</span>`;

                const userAnswerText = userAnswers[index] !== null ? q.options[userAnswers[index]] : "لا توجد إجابة";
                const correctAnswerText = q.options[q.correct];

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h4 class="font-bold text-slate-800 text-lg">السؤال ${index + 1}</h4>
                        ${answerStatus}
                    </div>
                    <p class="text-slate-700 mb-4">${q.text}</p>
                    ${q.code ? `<div class="bg-slate-900 rounded p-3 mb-4 text-left" dir="ltr"><pre class="code-font text-xs text-slate-300 overflow-x-auto">${q.code}</pre></div>` : ''}
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 text-sm">
                        <div class="bg-slate-50 p-3 rounded border border-slate-200">
                            <span class="text-slate-500 block text-xs uppercase tracking-wider font-bold mb-1">إجابتك</span>
                            <span class="${isCorrect ? 'text-green-700 font-medium' : 'text-red-700 font-medium'}">${userAnswerText}</span>
                        </div>
                        <div class="bg-green-50 p-3 rounded border border-green-200">
                            <span class="text-green-800 block text-xs uppercase tracking-wider font-bold mb-1">الإجابة الصحيحة</span>
                            <span class="text-green-800 font-bold">${correctAnswerText}</span>
                        </div>
                    </div>

                    <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100">
                        <p class="text-indigo-900 text-sm"><strong class="block mb-1"><i class="fa-solid fa-lightbulb text-yellow-500 ml-2"></i>الشرح:</strong>${q.explanation}</p>
                    </div>
                `;
                reviewSection.appendChild(card);
            });

            // Update Score Display
            const scoreDisplay = document.getElementById('score-display');
            const scoreRing = document.getElementById('score-ring');
            
            // Animate number
            let currentScore = 0;
            const scoreInterval = setInterval(() => {
                scoreDisplay.textContent = currentScore;
                if (currentScore >= score) clearInterval(scoreInterval);
                else currentScore++;
            }, 100);

            // Animate ring (Circumference is ~351.86)
            const offset = 351.86 - (351.86 * (score / 10));
            setTimeout(() => {
                scoreRing.style.strokeDashoffset = offset;
                // Color change based on score
                if (score < 5) scoreRing.style.stroke = '#ef4444'; // Red
                else if (score < 8) scoreRing.style.stroke = '#f59e0b'; // Orange
                else scoreRing.style.stroke = '#22c55e'; // Green
            }, 100);
        }

    </script>
</body>
</html>
